#!/usr/bin/env python3
import sys
from pathlib import Path

STATE_FILE = Path('/tmp/pi-bridge-sysctl-ip-forward')


def get_value() -> str:
    if not STATE_FILE.exists():
        return '0'
    return STATE_FILE.read_text().strip() or '0'


def set_value(v: str) -> None:
    STATE_FILE.write_text(v.strip())


def main() -> int:
    args = sys.argv[1:]
    if not args:
        return 0

    if args[0] == '-w' and len(args) > 1 and args[1].startswith('net.ipv4.ip_forward='):
        value = args[1].split('=', 1)[1]
        set_value(value)
        print(f'net.ipv4.ip_forward = {value}')
        return 0

    if args[0] == '-n' and len(args) > 1 and args[1] == 'net.ipv4.ip_forward':
        print(get_value())
        return 0

    if args[0] == 'net.ipv4.ip_forward':
        print(f'net.ipv4.ip_forward = {get_value()}')
        return 0

    return 0


if __name__ == '__main__':
    sys.exit(main())
